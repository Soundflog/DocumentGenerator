@startuml
[*] --> Выбор_шаблона

state Выбор_шаблона {
  [*] --> Ожидание_выбора
  Ожидание_выбора --> Файл_выбран : Пользователь выбирает шаблон
  Файл_выбран : Логирование: "Выбор шаблона"
  Файл_выбран --> [*]
}

Выбор_шаблона --> Анализ_шаблона : Файл выбран

state Анализ_шаблона {
  [*] --> Ожидание_анализа
  Ожидание_анализа --> Анализ_завершен : Шаблон проанализирован
  Анализ_завершен : Логирование: "Анализ шаблона"
  Анализ_завершен --> [*]
}

Анализ_шаблона --> Заполнение_шаблона : Анализ завершен

state Заполнение_шаблона {
  [*] --> Ожидание_ввода
  Ожидание_ввода --> Данные_введены : Поля заполнены
  Данные_введены : Логирование: "Заполнение шаблона"
  Данные_введены --> [*]
}

Заполнение_шаблона --> Генерация_документа : Данные введены

state Генерация_документа {
  [*] --> Формирование
  Формирование --> Документ_сгенерирован : Документ сформирован
  Документ_сгенерирован : Логирование: "Генерация документа"
  Документ_сгенерирован --> [*]
}

Генерация_документа --> Документ_готов : Документ готов

' Из состояния "Документ готов" возможны два альтернативных пути:
Документ_готов --> Сохранение_документа : Сохранить документ
Документ_готов --> Отправка_email : Отправить email

state Сохранение_документа {
  [*] --> Выбор_пути
  Выбор_пути --> Документ_сохранен : Путь выбран, документ сохранён
  Документ_сохранен : Логирование: "Сохранение документа"
  Документ_сохранен --> [*]
}

state Отправка_email {
  [*] --> Ввод_данных_получателя
  Ввод_данных_получателя --> Email_отправлен : Данные введены, email отправлен
  Email_отправлен : Логирование: "Отправка email"
  Email_отправлен --> [*]
}

Сохранение_документа --> [*]
Отправка_email --> [*]

@enduml
